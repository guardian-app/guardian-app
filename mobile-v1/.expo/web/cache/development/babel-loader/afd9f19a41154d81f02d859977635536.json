{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"D:\\\\PROJECTS\\\\group project 2\\\\projectApp\\\\guardian-mobile\\\\screens\\\\location2.js\";\n\nfunction _createSuper(Derived) { return function () { var Super = _getPrototypeOf(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component, useState, useEffect } from 'react';\nimport BackgroundGeolocation from '@mauron85/react-native-background-geolocation';\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport RefreshControl from \"react-native-web/dist/exports/RefreshControl\";\nimport AppState from \"react-native-web/dist/exports/AppState\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport MapView, { Marker, AnimatedRegion } from \"react-native-maps\";\nimport * as Location from 'expo-location';\nimport * as TaskManager from 'expo-task-manager';\nimport Constants from 'expo-constants';\nimport ActionButton from 'react-native-material-ui/src';\nimport { Actions, ActionConst } from 'react-native-router-flux';\nvar Width = Dimensions.get('window').width;\nvar Height = Dimensions.get('window').height;\nvar ASPECT_RATIO = Width / Height;\n\nvar Location2 = function (_Component) {\n  _inherits(Location2, _Component);\n\n  var _super = _createSuper(Location2);\n\n  function Location2(props) {\n    var _this;\n\n    _classCallCheck(this, Location2);\n\n    _this = _super.call(this, props);\n\n    _this._handleAppStateChange = function (nextAppState) {\n      var _useState = useState(null),\n          _useState2 = _slicedToArray(_useState, 2),\n          location = _useState2[0],\n          setLocation = _useState2[1];\n\n      var _useState3 = useState(null),\n          _useState4 = _slicedToArray(_useState3, 2),\n          errorMsg = _useState4[0],\n          setErrorMsg = _useState4[1];\n\n      console.log('done');\n\n      if (_this.state.appState.match(/inactive|background/) && nextAppState === 'active') {\n        console.log('App State: ' + 'App has come to the foreground!');\n        alert('App State: ' + 'App has come to the foreground!');\n        setTimeout(_this._backgroundLocation(), 15000);\n      }\n\n      console.log('App State: ' + nextAppState);\n\n      _this.setState({\n        appState: nextAppState\n      });\n\n      console.log('awaqq');\n    };\n\n    _this.onMapLayout = function () {\n      _this.setState({\n        isMapReady: true\n      });\n\n      console.log('location ppp');\n      console.log(_this.state);\n    };\n\n    _this.onPressLogout = function () {\n      console.log('till');\n      localStorage.setItem(\"key2\", \"\");\n      localStorage.setItem(\"role\", \"\");\n      localStorage.setItem(\"id\", \"\");\n      console.log(localStorage.getItem(\"key\"));\n\n      _this.setState({\n        appState: \"\"\n      });\n\n      Actions.LoginScreen();\n    };\n\n    _this.state = {\n      isMapReady: false,\n      latitude: 0,\n      longitude: 0,\n      isLoading: true,\n      location: [],\n      time: Date.now(),\n      error: null,\n      appState: AppState.currentState\n    };\n    _this._backgroundLocation = _this._backgroundLocation.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(Location2, [{\n    key: \"wait\",\n    value: function wait(timeout) {\n      return new Promise(function (resolve) {\n        setTimeout(resolve, timeout);\n      });\n    }\n  }, {\n    key: \"_sendLocation\",\n    value: function _sendLocation(lati, long, time) {\n      console.log('tilanga');\n      var child_id = localStorage.getItem(\"user_id\");\n      var token = localStorage.getItem(\"key2\");\n      fetch(\"http://192.168.43.133:3000/location/\" + child_id, {\n        method: \"POST\",\n        headers: {\n          \"Accept\": \"application/json\",\n          \"Content-Type\": \"application/json\",\n          \"Authorization\": \"Bearer \" + token\n        },\n        body: JSON.stringify({\n          longitude: long,\n          latitude: lati\n        })\n      }).then(function (response) {\n        console.log(\"ttttttttttttttttttt\");\n        console.log(response.status);\n\n        if (response.status == 404) {\n          console.log('comeeeeeee');\n        }\n\n        if (response.status == 401) {\n          console.log('failed2');\n        }\n\n        if (response.status == 200) {\n          console.log('done');\n        } else {\n          return response;\n        }\n      }).then(function (response) {\n        return response.json();\n      }).then(function (json) {\n        console.log('Request succeeded with JSON response:', json);\n\n        try {\n          console.log('try');\n        } catch (e) {\n          console.log(\"catch\");\n        }\n\n        console.log('key');\n      }).catch(function (error) {\n        console.log('Request failed:', error);\n      });\n    }\n  }, {\n    key: \"_activeLocation\",\n    value: function _activeLocation() {\n      var _this2 = this;\n\n      navigator.geolocation.getCurrentPosition(function (position) {\n        console.log('tui');\n        console.log('tuitui');\n\n        _this2.setState({\n          latitude: position.coords.latitude,\n          longitude: position.coords.longitude,\n          error: null\n        });\n\n        console.log('location pppqqqqqq');\n        console.log(position.timestamp);\n        console.log(position.coords.latitude);\n        console.log(position.coords.longitude);\n        console.log(position.coords.timestamp);\n\n        _this2._sendLocation(position.coords.latitude, position.coords.longitude, position.timestamp);\n\n        setTimeout(function () {\n          console.log('vdqq');\n        }, 1000);\n      }, function (error) {\n        return _this2.setState({\n          error: error.message\n        });\n      }, {\n        enableHighAccuracy: true,\n        timeout: 20000,\n        maximumAge: 2000\n      });\n    }\n  }, {\n    key: \"_backgroundLocation\",\n    value: function _backgroundLocation() {\n      var _useState5 = useState(null),\n          _useState6 = _slicedToArray(_useState5, 2),\n          location = _useState6[0],\n          setLocation = _useState6[1];\n\n      var _useState7 = useState(null),\n          _useState8 = _slicedToArray(_useState7, 2),\n          errorMsg = _useState8[0],\n          setErrorMsg = _useState8[1];\n\n      useEffect(function () {\n        (function _callee() {\n          var _await$Location$reque, status, location;\n\n          return _regeneratorRuntime.async(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return _regeneratorRuntime.awrap(Location.requestPermissionsAsync());\n\n                case 2:\n                  _await$Location$reque = _context.sent;\n                  status = _await$Location$reque.status;\n\n                  if (status !== 'granted') {\n                    setErrorMsg('Permission to access location was denied');\n                  }\n\n                  _context.next = 7;\n                  return _regeneratorRuntime.awrap(Location.getCurrentPositionAsync({}));\n\n                case 7:\n                  location = _context.sent;\n                  setLocation(location);\n\n                case 9:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, null, null, null, Promise);\n        })();\n      });\n      var text = 'Waiting..';\n\n      if (errorMsg) {\n        text = errorMsg;\n      } else if (location) {\n        text = JSON.stringify(location);\n        console.log('fffffffffffff');\n        console.log(location.latitude);\n        console.log(location.timestamp);\n        this.setState({\n          latitude: location.latitude,\n          longitude: location.longitude,\n          error: null\n        });\n\n        this._sendLocation(location.latitude, location.longitude, location.timestamp);\n      }\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this3 = this;\n\n      if (localStorage.getItem(\"key2\") == \"\") {\n        Actions.LoginScreen();\n      }\n\n      AppState.addEventListener('change', this._handleAppStateChange);\n      var lati;\n      var long;\n      var time = 0;\n      console.log('we');\n      console.log(this.state.appState);\n      console.log('ppcscs');\n\n      if (this.state.appState == \"active\") {\n        console.log('acacacactive');\n        this.interval = setInterval(function () {\n          return _this3._activeLocation();\n        }, 15000);\n      } else {\n        this.interval = setInterval(function () {\n          return _this3._backgroundLocation();\n        }, 15000);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (localStorage.getItem(\"key2\") == \"\") {\n        Actions.LoginScreen();\n      }\n\n      AppState.removeEventListener('change', this._handleAppStateChange);\n      clearInterval(this.interval);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(View, {\n        Style: styles.container,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 7\n        }\n      }, React.createElement(MapView, {\n        onPress: function onPress(e) {\n          return console.log(e.nativeEvent);\n        },\n        provider: \"google\",\n        mapType: \"mutedStandard\",\n        paddingAdjustmentBehavio: \"GoogleMaps\",\n        showsIndoorLevelPicker: true,\n        cacheEnabled: true,\n        loadingEnabled: true,\n        isAccessibilityElement: true,\n        showsScale: true,\n        showsCompass: true,\n        showsPointsOfInterest: true,\n        showsBuildings: true,\n        showsUserLocation: true,\n        style: styles.map,\n        region: {\n          latitude: 6.927079,\n          longitude: 79.861244,\n          latitudeDelta: 0.2,\n          longitudeDelta: 5\n        },\n        onLayout: this.onMapLayout,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 9\n        }\n      }, this.state.isMapReady && React.createElement(Marker, {\n        coordinate: this.state,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 13\n        }\n      })), React.createElement(Button, {\n        title: \"back\",\n        onPress: function onPress() {\n          return Actions.FrontScreen();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 277,\n          columnNumber: 9\n        }\n      }), React.createElement(Button, {\n        title: \"Logout\",\n        onPress: this.onPressLogout,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 278,\n          columnNumber: 9\n        }\n      }));\n    }\n  }]);\n\n  return Location2;\n}(Component);\n\nexport { Location2 as default };\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1\n  },\n  map: {\n    height: Height - 70,\n    width: Width\n  }\n});","map":{"version":3,"sources":["D:/PROJECTS/group project 2/projectApp/guardian-mobile/screens/location2.js"],"names":["React","Component","useState","useEffect","BackgroundGeolocation","MapView","Marker","AnimatedRegion","Location","TaskManager","Constants","ActionButton","Actions","ActionConst","Width","Dimensions","get","width","Height","height","ASPECT_RATIO","Location2","props","_handleAppStateChange","nextAppState","location","setLocation","errorMsg","setErrorMsg","console","log","state","appState","match","alert","setTimeout","_backgroundLocation","setState","onMapLayout","isMapReady","onPressLogout","localStorage","setItem","getItem","LoginScreen","latitude","longitude","isLoading","time","Date","now","error","AppState","currentState","bind","timeout","Promise","resolve","lati","long","child_id","token","fetch","method","headers","body","JSON","stringify","then","response","status","json","e","catch","navigator","geolocation","getCurrentPosition","position","coords","timestamp","_sendLocation","message","enableHighAccuracy","maximumAge","requestPermissionsAsync","getCurrentPositionAsync","text","addEventListener","interval","setInterval","_activeLocation","removeEventListener","clearInterval","styles","container","nativeEvent","map","latitudeDelta","longitudeDelta","FrontScreen","StyleSheet","create","flex"],"mappings":"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","sourcesContent":["\r\nimport React, { Component,useState, useEffect } from 'react';\r\nimport BackgroundGeolocation from '@mauron85/react-native-background-geolocation';\r\n///////////////////////\r\n// import React, {Component} from 'react';\r\nimport {Alert,Dimensions, StyleSheet, Text, View,RefreshControl, AppState, Button} from \"react-native\";\r\nimport MapView, {Marker, AnimatedRegion} from \"react-native-maps\";\r\nimport * as Location from 'expo-location';\r\nimport * as TaskManager from 'expo-task-manager';\r\nimport Constants from 'expo-constants'\r\nimport ActionButton from 'react-native-material-ui/src'\r\nimport {Actions, ActionConst} from 'react-native-router-flux';\r\n\r\nconst Width = Dimensions.get('window').width;\r\nconst Height = Dimensions.get('window').height;\r\n\r\nconst ASPECT_RATIO = Width / Height;\r\n\r\n\r\nexport default class Location2 extends Component{\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isMapReady: false,\r\n      latitude: 0,\r\n      longitude: 0,\r\n      isLoading: true,\r\n      location: [],\r\n      time: Date.now(),\r\n      error: null,\r\n      appState: AppState.currentState,\r\n      \r\n    };\r\n\r\n    this._backgroundLocation = this._backgroundLocation.bind(this);\r\n  }\r\n\r\n  wait(timeout) {\r\n    return new Promise(resolve => {\r\n      setTimeout(resolve, timeout);\r\n    });\r\n  }\r\n\r\n  _sendLocation(lati,long,time){\r\n      console.log('tilanga')\r\n      const child_id = localStorage.getItem(\"user_id\");\r\n      const token = localStorage.getItem(\"key2\");\r\n\r\n      fetch(\"http://192.168.43.133:3000/location/\"+child_id,{\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Accept\": \"application/json\",\r\n        \"Content-Type\": \"application/json\",\r\n        \"Authorization\": \"Bearer \"+token,\r\n      },\r\n      body: JSON.stringify({\r\n        longitude: long,\r\n        latitude: lati,\r\n        //timestamp: time,\r\n      })\r\n\r\n    })\r\n\r\n    .then(function(response) {\r\n      \r\n      console.log(\"ttttttttttttttttttt\")\r\n      console.log(response.status);\r\n      \r\n       if(response.status == 404){\r\n        console.log('comeeeeeee')\r\n        \r\n      } \r\n      if(response.status == 401){\r\n        console.log('failed2')\r\n        \r\n      }\r\n      if(response.status == 200){\r\n        console.log('done')\r\n      }\r\n      else{\r\n        return response;\r\n      }\r\n    }).then(function(response) {\r\n      return response.json();\r\n    }).then(function(json) {\r\n      console.log('Request succeeded with JSON response:', json);       \r\n        try {\r\n          console.log('try')\r\n        } catch (e) {\r\n\r\n          console.log(\"catch\");\r\n        }\r\n        console.log('key');\r\n        \r\n    }).catch(function(error) {\r\n      console.log('Request failed:', error);\r\n    });\r\n    \r\n  }\r\n\r\n  _activeLocation(){\r\n    navigator.geolocation.getCurrentPosition(position => {\r\n      console.log('tui')\r\n      console.log('tuitui')\r\n        this.setState({\r\n          latitude: position.coords.latitude,\r\n          longitude: position.coords.longitude,\r\n          error: null\r\n        });\r\n        console.log('location pppqqqqqq');\r\n        console.log(position.timestamp);\r\n        console.log(position.coords.latitude);\r\n        console.log(position.coords.longitude);\r\n        console.log(position.coords.timestamp);\r\n\r\n        this._sendLocation(position.coords.latitude,position.coords.longitude,position.timestamp)\r\n\r\n        setTimeout(function(){\r\n          console.log('vdqq')\r\n        },1000);\r\n    }, \r\n    error => this.setState({error: error.message}),\r\n    {enableHighAccuracy: true, timeout: 20000, maximumAge: 2000}\r\n    );\r\n  }\r\n\r\n  _backgroundLocation(){\r\n    const [location, setLocation] = useState(null);\r\n    const [errorMsg, setErrorMsg] = useState(null);\r\n\r\n    useEffect(() => {\r\n      (async () => {\r\n        let { status } = await Location.requestPermissionsAsync();\r\n        if (status !== 'granted') {\r\n          setErrorMsg('Permission to access location was denied');\r\n        }\r\n  \r\n        let location = await Location.getCurrentPositionAsync({});\r\n        setLocation(location);\r\n      })();\r\n    });\r\n  \r\n    let text = 'Waiting..';\r\n    if (errorMsg) {\r\n      text = errorMsg;\r\n    } else if (location) {\r\n      text = JSON.stringify(location);\r\n      console.log('fffffffffffff')\r\n      console.log(location.latitude);\r\n      console.log(location.timestamp);\r\n      this.setState({\r\n        latitude: location.latitude,\r\n        longitude: location.longitude,\r\n        error: null\r\n      });\r\n\r\n      this._sendLocation(location.latitude, location.longitude, location.timestamp);\r\n    }\r\n\r\n  }\r\n\r\n  componentDidMount() {\r\n\r\n    if(localStorage.getItem(\"key2\") == \"\"){\r\n      Actions.LoginScreen();\r\n    }\r\n    \r\n    AppState.addEventListener('change', this._handleAppStateChange);\r\n\r\n    \r\n    \r\n    var lati;\r\n    var long;\r\n\r\n    let time = 0\r\n\r\n    console.log('we');\r\n      console.log(this.state.appState);\r\n      console.log('ppcscs');\r\n\r\n      //setTimeout(this._activeLocation(),15000)\r\n\r\n      if(this.state.appState == \"active\"){\r\n        console.log('acacacactive')\r\n        this.interval = setInterval(() => this._activeLocation(), 15000);\r\n      }else{\r\n        this.interval = setInterval(() => this._backgroundLocation(), 15000);\r\n      }\r\n\r\n      \r\n\r\n      //this._activeLocation();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if(localStorage.getItem(\"key2\") == \"\"){\r\n      Actions.LoginScreen();\r\n    }\r\n    AppState.removeEventListener('change', this._handleAppStateChange);\r\n    clearInterval(this.interval);\r\n  }\r\n\r\n  _handleAppStateChange = nextAppState => {\r\n    const [location, setLocation] = useState(null);\r\n    const [errorMsg, setErrorMsg] = useState(null);\r\n    console.log('done')\r\n    if (this.state.appState.match(/inactive|background/) && nextAppState === 'active') {\r\n      console.log('App State: ' + 'App has come to the foreground!');\r\n      alert('App State: ' + 'App has come to the foreground!');\r\n      \r\n\r\n      setTimeout(this._backgroundLocation(), 15000);\r\n\r\n      //this._backgroundLocation();\r\n      \r\n    }\r\n    console.log('App State: ' + nextAppState);\r\n    //alert('App State: ' + nextAppState);\r\n    this.setState({ appState: nextAppState });\r\n    console.log('awaqq')\r\n  };\r\n\r\n  onMapLayout = () => {\r\n    this.setState({ isMapReady: true });\r\n    console.log('location ppp')\r\n    console.log(this.state)\r\n  }\r\n\r\n  onPressLogout =() => {\r\n    console.log('till')\r\n    localStorage.setItem(\"key2\", \"\");\r\n    localStorage.setItem(\"role\",\"\")\r\n    localStorage.setItem(\"id\",\"\");\r\n    console.log(localStorage.getItem(\"key\"));\r\n    this.setState({ appState: \"\" });\r\n    Actions.LoginScreen();\r\n}\r\n\r\n  \r\n\r\n  render() {\r\n\r\n\r\n    return(\r\n      <View Style = {styles.container}>\r\n                \r\n        <MapView\r\n          onPress={e => console.log(e.nativeEvent)}\r\n          provider='google'\r\n          mapType='mutedStandard'\r\n          paddingAdjustmentBehavio=\"GoogleMaps\"\r\n          showsIndoorLevelPicker={true}\r\n          cacheEnabled={true}\r\n          loadingEnabled\t={true}\r\n          isAccessibilityElement\t= {true}\r\n          showsScale\r\n          showsCompass\r\n          showsPointsOfInterest\r\n          showsBuildings\r\n          showsUserLocation = {true}\r\n          style={styles.map}\r\n          region={\r\n            {\r\n            latitude: 6.927079,\r\n            longitude: 79.861244,\r\n            latitudeDelta: 0.2,\r\n            longitudeDelta: 5\r\n          }\r\n        }\r\n          onLayout={this.onMapLayout}\r\n        >\r\n          { this.state.isMapReady && \r\n            <Marker coordinate={this.state}/>\r\n          }\r\n          \r\n        </MapView>  \r\n        <Button title=\"back\" onPress={() => Actions.FrontScreen() } />\r\n        <Button title=\"Logout\" onPress={this.onPressLogout } />\r\n      </View>\r\n    )\r\n  }\r\n}\r\n\r\nconst styles =  StyleSheet.create({\r\n  container: {\r\n    flex: 1\r\n  },\r\n  map: {\r\n    //flex: 1,\r\n    height: Height-70,\r\n    width: Width\r\n  }\r\n})"]},"metadata":{},"sourceType":"module"}